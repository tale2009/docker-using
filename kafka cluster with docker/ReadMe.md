1.kafka基于zookeeper来搭建集群

启动zookeeper
```
docker run --network mynetwork --ip 172.18.0.3 --name zookeeper-cluster -p 21810:2181 -d zookeeper:3.4.14 
```
2.连接zookeeper创建集群

启动3个kafka
```
docker run --network mynetwork --ip 172.18.0.4 --name kafka0 -p 920:940 -e KAFKA_BROKER_ID=0 -e KAFKA_ZOOKEEPER_CONNECT=172.18.0.3:2181 -e KAFKA_LISTENERS=INSIDE://0.0.0.0:9092,OUTSIDE://0.0.0.0:940 -e KAFKA_ADVERTISED_LISTENERS=INSIDE://172.18.0.4:9092,OUTSIDE://localhost:920 -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT -e KAFKA_INTER_BROKER_LISTENER_NAME=INSIDE -d wurstmeister/kafka
docker run --network mynetwork --ip 172.18.0.5 --name kafka1 -p 921:940 -e KAFKA_BROKER_ID=1 -e KAFKA_ZOOKEEPER_CONNECT=172.18.0.3:2181 -e KAFKA_LISTENERS=INSIDE://0.0.0.0:9092,OUTSIDE://0.0.0.0:940 -e KAFKA_ADVERTISED_LISTENERS=INSIDE://172.18.0.5:9092,OUTSIDE://localhost:921 -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT -e KAFKA_INTER_BROKER_LISTENER_NAME=INSIDE -d wurstmeister/kafka
docker run --network mynetwork --ip 172.18.0.6 --name kafka2 -p 922:940 -e KAFKA_BROKER_ID=2 -e KAFKA_ZOOKEEPER_CONNECT=172.18.0.3:2181 -e KAFKA_LISTENERS=INSIDE://0.0.0.0:9092,OUTSIDE://0.0.0.0:940 -e KAFKA_ADVERTISED_LISTENERS=INSIDE://172.18.0.6:9092,OUTSIDE://localhost:922 -e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT -e KAFKA_INTER_BROKER_LISTENER_NAME=INSIDE -d wurstmeister/kafka
```
```
当使用容器来运行kafka的时候，kafka的访问需要设置
特殊参数说明
-e KAFKA_LISTENERS=INSIDE://0.0.0.0:9092,OUTSIDE://0.0.0.0:940 容器内部通信端口9092，宿主机访问内部时提供给外部映射的端口
-e KAFKA_ADVERTISED_LISTENERS=INSIDE://172.18.0.4:9092,OUTSIDE://localhost:920 容器内部使用内部网桥的ip，容器外部访问kafka的ip，宿主机的920映射到容器中940已在run -p中定义
-e KAFKA_LISTENER_SECURITY_PROTOCOL_MAP=INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT 映射协议
-e KAFKA_INTER_BROKER_LISTENER_NAME=INSIDE 指向跨Broker间通信时的命名地址
```